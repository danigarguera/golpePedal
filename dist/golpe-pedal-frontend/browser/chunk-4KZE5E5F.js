import{a as q}from"./chunk-GZI56UPR.js";import{c as A,f as B,k as L,l as $,m as z,t as H}from"./chunk-ND65VQ52.js";import{a as G}from"./chunk-ATC3HXFD.js";import{$ as f,B as _,C as w,Da as W,G as m,Ia as R,J as l,M as n,N as r,O as p,R as O,S as u,T as g,W as c,X as C,Y as I,Z as E,aa as b,ba as h,ea as S,fa as v,ga as x,ia as P,pa as D,q as T,qa as k,r as y,ra as V,ta as U,ua as j,ya as N,z as a}from"./chunk-YAXSTRSO.js";var F=i=>[i,"EUR","symbol","1.2-2","es-ES"],M=(i,t)=>({"bi-caret-up-fill":i,"bi-caret-down-fill":t});function K(i,t){if(i&1&&(n(0,"option",30),c(1),r()),i&2){let e=t.$implicit;l("value",e.id),a(),E(" ",e.nombre," ",e.apellido1," ")}}function Q(i,t){if(i&1&&(n(0,"option",9),c(1),r()),i&2){let e=t.$implicit;l("ngValue",e.id),a(),C(e.nombre)}}function X(i,t){if(i&1&&(n(0,"option",9),c(1),r()),i&2){let e=t.$implicit;l("ngValue",e.id),a(),C(e.nombre)}}function Y(i,t){if(i&1&&p(0,"i",31),i&2){let e=g();l("ngClass",v(1,M,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function Z(i,t){if(i&1&&p(0,"i",31),i&2){let e=g();l("ngClass",v(1,M,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function ee(i,t){if(i&1&&p(0,"i",31),i&2){let e=g();l("ngClass",v(1,M,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function te(i,t){if(i&1){let e=O();n(0,"tr")(1,"td"),c(2),r(),n(3,"td"),c(4),r(),n(5,"td"),c(6),x(7,"currency"),r(),n(8,"td")(9,"button",32),u("click",function(){let s=T(e).$implicit,d=g();return y(d.anadirAlCarrito(s))}),p(10,"i",33),c(11," A\xF1adir "),r()()()}if(i&2){let e=t.$implicit;a(2),C(e.nombre),a(2),C(e.marca),a(2),C(P(7,3,S(9,F,e.precio)))}}function ie(i,t){if(i&1){let e=O();n(0,"li",34)(1,"span"),c(2),r(),n(3,"span"),c(4),x(5,"currency"),n(6,"button",35),u("click",function(){let s=T(e).$implicit,d=g();return y(d.eliminarDelCarrito(s.componenteId))}),p(7,"i",36),r()()()}if(i&2){let e=t.$implicit;a(2),E(" ",e.nombre," \xD7 ",e.cantidad," "),a(2),I(" ",P(5,3,S(9,F,e.precio*e.cantidad))," ")}}function ne(i,t){if(i&1&&(n(0,"div",37),c(1),r()),i&2){let e=g();a(),C(e.mensaje)}}function re(i,t){if(i&1&&(n(0,"div",38),c(1),r()),i&2){let e=g();a(),C(e.error)}}var J=class i{constructor(t,e,o,s){this.usuarioService=t;this.pedidoService=e;this.http=o;this.router=s}apiUrl=R.apiUrl;clientes=[];tiposComponente=[];componentesFiltrados=[];marcas=[];clienteSeleccionadoId=null;tipoSeleccionado=null;marcaSeleccionada=null;ordenActual={campo:"nombre",ascendente:!0};carrito=[];mensaje="";error="";ngOnInit(){this.cargarClientes(),this.cargarTiposComponente(),this.cargarMarcas(),this.cargarTodosLosComponentes()}cargarClientes(){this.usuarioService.obtenerUsuarios().subscribe({next:t=>this.clientes=t,error:()=>this.error="Error cargando clientes."})}cargarTiposComponente(){this.http.get(`${this.apiUrl}/tipos-componente`).subscribe({next:t=>this.tiposComponente=t,error:()=>this.error="Error cargando tipos de componente."})}cargarMarcas(){this.http.get(`${this.apiUrl}/marcas`).subscribe({next:t=>this.marcas=t,error:()=>this.error="Error cargando marcas."})}filtrarComponentesPorTipo(){let t=new URLSearchParams;this.tipoSeleccionado!==null&&this.tipoSeleccionado>0&&t.append("tipoComponenteId",this.tipoSeleccionado.toString()),this.marcaSeleccionada&&t.append("marcaId",this.marcaSeleccionada.toString()),this.http.get(`${this.apiUrl}/componentes/buscar?${t.toString()}`).subscribe({next:e=>this.componentesFiltrados=e,error:()=>this.error="Error filtrando componentes."})}campoOrden="";direccionOrden="asc";ordenarPor(t){this.campoOrden===t?this.direccionOrden=this.direccionOrden==="asc"?"desc":"asc":(this.campoOrden=t,this.direccionOrden="asc"),this.componentesFiltrados.sort((e,o)=>{let s=e[t],d=o[t];return s<d?this.direccionOrden==="asc"?-1:1:s>d?this.direccionOrden==="asc"?1:-1:0})}anadirAlCarrito(t){let e=this.carrito.find(o=>o.componenteId===t.id);e?e.cantidad+=1:this.carrito.push({componenteId:t.id,nombre:t.nombre,descripcion:t.descripcion,precio:t.precio,cantidad:1})}cargarTodosLosComponentes(){this.http.get(`${this.apiUrl}/componentes`).subscribe({next:t=>{this.componentesFiltrados=t},error:()=>this.error="Error cargando los componentes."})}eliminarDelCarrito(t){this.carrito=this.carrito.filter(e=>e.componenteId!==t)}calcularTotal(){return this.carrito.reduce((t,e)=>t+e.precio*e.cantidad,0)}crearPedido(){if(!this.clienteSeleccionadoId||this.carrito.length===0){this.error="Completa cliente y carrito antes de crear el pedido.";return}let t={usuarioId:this.clienteSeleccionadoId,direccionId:null,lineas:this.carrito.map(e=>({componenteId:e.componenteId,cantidad:e.cantidad,precioUnitario:e.precio}))};this.pedidoService.crearPedidoComoEmpleado(t).subscribe({next:e=>{this.mensaje="\u2705 Pedido creado exitosamente",this.error="",this.carrito=[],setTimeout(()=>{this.mensaje="",this.router.navigate(["/dashboard/detalle-venta",e.id],{state:{pedido:e}})},1e3)},error:()=>{this.error="\u274C Error al crear el pedido",this.mensaje=""}})}static \u0275fac=function(e){return new(e||i)(_(q),_(G),_(N),_(W))};static \u0275cmp=w({type:i,selectors:[["app-crear-pedido"]],decls:62,vars:25,consts:[[1,"container","mt-4","max-ancho"],[1,"texto-grande","fw-bold","mb-4"],[1,"bi","bi-bag-plus-fill","me-2"],[1,"card","sombra-suave","borde-claro","p-3","mb-4"],[1,"mb-3"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-label"],["name","cliente",1,"form-select","input-estilizado",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["name","tipo",1,"form-select","input-estilizado",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["name","marca",1,"form-select","input-estilizado",3,"ngModelChange","change","ngModel"],[1,"mt-4","mb-3"],[1,"bi","bi-box-seam","me-2"],[1,"table","table-hover","table-bordered","align-middle","sombra-suave"],[1,"table-light"],[1,"sortable",3,"click"],["class","bi",3,"ngClass",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"mt-5","mb-3"],[1,"bi","bi-clipboard-check","me-2"],[1,"list-group","mb-3","sombra-suave"],["class","list-group-item d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"btn","btn-secundario",3,"click"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[3,"value"],[1,"bi",3,"ngClass"],[1,"btn","btn-sm","btn-primario",3,"click"],[1,"bi","bi-cart-plus"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-danger","ms-2",3,"click"],[1,"bi","bi-trash-fill"],[1,"alert","alert-success","mt-3"],[1,"alert","alert-danger","mt-3"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"h2",1),p(2,"i",2),c(3," Crear Pedido "),r(),n(4,"div",3)(5,"h5",4),c(6,"Filtros de pedido"),r(),n(7,"div",5)(8,"div",6)(9,"label",7),c(10,"Cliente"),r(),n(11,"select",8),h("ngModelChange",function(d){return b(o.clienteSeleccionadoId,d)||(o.clienteSeleccionadoId=d),d}),n(12,"option",9),c(13,"-- Seleccionar cliente --"),r(),m(14,K,2,3,"option",10),r()(),n(15,"div",6)(16,"label",7),c(17,"Tipo de componente"),r(),n(18,"select",11),h("ngModelChange",function(d){return b(o.tipoSeleccionado,d)||(o.tipoSeleccionado=d),d}),u("change",function(){return o.filtrarComponentesPorTipo()}),n(19,"option",9),c(20,"-- Todos los tipos --"),r(),m(21,Q,2,2,"option",12),r()(),n(22,"div",6)(23,"label",7),c(24,"Marca"),r(),n(25,"select",13),h("ngModelChange",function(d){return b(o.marcaSeleccionada,d)||(o.marcaSeleccionada=d),d}),u("change",function(){return o.filtrarComponentesPorTipo()}),n(26,"option",9),c(27,"-- Todas las marcas --"),r(),m(28,X,2,2,"option",12),r()()()(),n(29,"h4",14),p(30,"i",15),c(31," Componentes disponibles"),r(),n(32,"table",16)(33,"thead",17)(34,"tr")(35,"th",18),u("click",function(){return o.ordenarPor("nombre")}),c(36," Nombre "),m(37,Y,1,4,"i",19),r(),n(38,"th",18),u("click",function(){return o.ordenarPor("marca")}),c(39," Marca "),m(40,Z,1,4,"i",19),r(),n(41,"th",18),u("click",function(){return o.ordenarPor("precio")}),c(42," Precio "),m(43,ee,1,4,"i",19),r(),n(44,"th"),c(45,"Acciones"),r()()(),n(46,"tbody"),m(47,te,12,11,"tr",20),r()(),n(48,"h4",21),p(49,"i",22),c(50," Componentes seleccionados"),r(),n(51,"ul",23),m(52,ie,8,11,"li",24),r(),n(53,"div",25)(54,"h5"),c(55),x(56,"currency"),r(),n(57,"button",26),u("click",function(){return o.crearPedido()}),p(58,"i",27),c(59," Finalizar Pedido "),r()(),m(60,ne,2,1,"div",28)(61,re,2,1,"div",29),r()),e&2&&(a(11),f("ngModel",o.clienteSeleccionadoId),a(),l("ngValue",null),a(2),l("ngForOf",o.clientes),a(4),f("ngModel",o.tipoSeleccionado),a(),l("ngValue",null),a(2),l("ngForOf",o.tiposComponente),a(4),f("ngModel",o.marcaSeleccionada),a(),l("ngValue",null),a(2),l("ngForOf",o.marcas),a(9),l("ngIf",o.campoOrden==="nombre"),a(3),l("ngIf",o.campoOrden==="marca"),a(3),l("ngIf",o.campoOrden==="precio"),a(4),l("ngForOf",o.componentesFiltrados),a(5),l("ngForOf",o.carrito),a(3),I("Total: ",P(56,17,S(23,F,o.calcularTotal())),""),a(5),l("ngIf",o.mensaje),a(),l("ngIf",o.error))},dependencies:[j,D,k,V,U,H,$,z,L,A,B],encapsulation:2})};export{J as CrearPedidoComponent};
