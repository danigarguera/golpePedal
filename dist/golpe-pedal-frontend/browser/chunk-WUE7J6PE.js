import{a as L,c as H,f as R,k as j,l as U,m as G,t as J}from"./chunk-ND65VQ52.js";import{$ as x,B as P,C as O,Da as B,G as u,Ia as w,J as c,M as i,N as o,O as C,R as y,S as m,T as p,W as d,X as h,aa as b,ba as E,ea as F,fa as f,ga as S,ha as T,ia as I,pa as M,q as _,qa as V,r as g,ra as k,sa as N,ta as D,ua as W,xa as A,ya as z,z as s}from"./chunk-YAXSTRSO.js";var v=(n,t)=>({"bi-caret-up-fill":n,"bi-caret-down-fill":t}),K=n=>[n,"EUR","symbol","1.2-2","es-ES"];function Q(n,t){n&1&&(i(0,"div",23),d(1,"Cargando pedidos..."),o())}function X(n,t){n&1&&(i(0,"div",24),d(1," No hay pedidos para mostrar. "),o())}function Y(n,t){if(n&1&&C(0,"i",31),n&2){let e=p(2);c("ngClass",f(1,v,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function Z(n,t){if(n&1&&C(0,"i",31),n&2){let e=p(2);c("ngClass",f(1,v,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function $(n,t){if(n&1&&C(0,"i",31),n&2){let e=p(2);c("ngClass",f(1,v,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function ee(n,t){if(n&1&&C(0,"i",31),n&2){let e=p(2);c("ngClass",f(1,v,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function te(n,t){if(n&1&&C(0,"i",31),n&2){let e=p(2);c("ngClass",f(1,v,e.direccionOrden==="asc",e.direccionOrden==="desc"))}}function ie(n,t){if(n&1){let e=y();i(0,"tr")(1,"td",32),m("click",function(){let r=_(e).$implicit,l=p(2);return g(l.irADetalle(r.id))}),d(2),o(),i(3,"td",32),m("click",function(){let r=_(e).$implicit,l=p(2);return g(l.irADetalle(r.id))}),d(4),S(5,"date"),o(),i(6,"td"),d(7),o(),i(8,"td",33),d(9),S(10,"currency"),o(),i(11,"td")(12,"select",34),E("ngModelChange",function(r){let l=_(e).$implicit;return b(l.estado,r)||(l.estado=r),g(r)}),m("change",function(){let r=_(e).$implicit,l=p(2);return g(l.actualizarEstado(r))}),i(13,"option",12),d(14,"Pendiente"),o(),i(15,"option",13),d(16,"Enviado"),o(),i(17,"option",14),d(18,"Entregado"),o(),i(19,"option",15),d(20,"Cancelado"),o()()()()}if(n&2){let e=t.$implicit;s(2),h(e.id),s(2),h(T(5,5,e.fecha,"short")),s(3),h(e.cliente),s(2),h(I(10,8,F(14,K,e.total))),s(3),x("ngModel",e.estado)}}function ne(n,t){if(n&1){let e=y();i(0,"table",25)(1,"thead",26)(2,"tr")(3,"th",27),m("click",function(){_(e);let r=p();return g(r.ordenarPor("id"))}),d(4," ID "),u(5,Y,1,4,"i",28),o(),i(6,"th",27),m("click",function(){_(e);let r=p();return g(r.ordenarPor("fecha"))}),d(7," Fecha "),u(8,Z,1,4,"i",28),o(),i(9,"th",27),m("click",function(){_(e);let r=p();return g(r.ordenarPor("cliente"))}),d(10," Cliente "),u(11,$,1,4,"i",28),o(),i(12,"th",29),m("click",function(){_(e);let r=p();return g(r.ordenarPor("total"))}),d(13," Total "),u(14,ee,1,4,"i",28),o(),i(15,"th",27),m("click",function(){_(e);let r=p();return g(r.ordenarPor("estado"))}),d(16," Estado "),u(17,te,1,4,"i",28),o()()(),i(18,"tbody"),u(19,ie,21,16,"tr",30),o()()}if(n&2){let e=p();s(5),c("ngIf",e.campoOrden==="id"),s(3),c("ngIf",e.campoOrden==="fecha"),s(3),c("ngIf",e.campoOrden==="cliente"),s(3),c("ngIf",e.campoOrden==="total"),s(3),c("ngIf",e.campoOrden==="estado"),s(2),c("ngForOf",e.pedidosFiltrados)}}var q=class n{constructor(t,e){this.http=t;this.router=e}pedidos=[];pedidosFiltrados=[];desde="";hasta="";estadoFiltro="";cargando=!1;campoOrden="";direccionOrden="asc";ngOnInit(){this.cargarPedidos()}cargarPedidos(){this.cargando=!0;let t=new A;this.desde&&(t=t.set("desde",this.desde)),this.hasta&&(t=t.set("hasta",this.hasta)),this.http.get(`${w.apiUrl}/pedidos/por-clientes`,{params:t}).subscribe({next:e=>{this.pedidos=e,this.aplicarFiltroEstado(),this.ordenarPor(this.campoOrden),this.cargando=!1},error:e=>{console.error("Error al cargar pedidos:",e),this.cargando=!1}})}aplicarFiltroEstado(){this.estadoFiltro?this.pedidosFiltrados=this.pedidos.filter(t=>t.estado===this.estadoFiltro):this.pedidosFiltrados=[...this.pedidos]}actualizarEstado(t){this.http.put(`${w.apiUrl}/pedidos/${t.id}/estado`,JSON.stringify(t.estado),{headers:{"Content-Type":"application/json"}}).subscribe({next:()=>console.log("\u2705 Estado actualizado correctamente"),error:e=>console.error("Error al actualizar estado:",e)})}ordenarPor(t){this.campoOrden===t?this.direccionOrden=this.direccionOrden==="asc"?"desc":"asc":(this.campoOrden=t,this.direccionOrden="asc"),this.pedidosFiltrados.sort((e,a)=>{let r=e[t]?.toString().toLowerCase?.()??"",l=a[t]?.toString().toLowerCase?.()??"";return r<l?this.direccionOrden==="asc"?-1:1:r>l?this.direccionOrden==="asc"?1:-1:0})}irADetalle(t){this.router.navigate(["/dashboard/detalle-venta",t])}static \u0275fac=function(e){return new(e||n)(P(z),P(B))};static \u0275cmp=O({type:n,selectors:[["app-pedidos-clientes"]],decls:35,vars:6,consts:[[1,"container","py-4"],[1,"texto-grande","fw-bold","mb-4"],[1,"bi","bi-box-seam","me-2"],[1,"row","g-3","align-items-end","mb-4","sombra-suave","p-3","borde-claro","rounded-3"],[1,"col-md-3"],["for","desde",1,"form-label"],["type","date","id","desde",1,"form-control","input-estilizado",3,"ngModelChange","ngModel"],["for","hasta",1,"form-label"],["type","date","id","hasta",1,"form-control","input-estilizado",3,"ngModelChange","ngModel"],["for","estadoFiltro",1,"form-label"],["id","estadoFiltro",1,"form-select","input-estilizado",3,"ngModelChange","change","ngModel"],["value",""],["value","PENDIENTE"],["value","ENVIADO"],["value","ENTREGADO"],["value","CANCELADO"],[1,"col-md-3","text-end"],[1,"btn","btn-primario","w-100",3,"click"],[1,"bi","bi-filter","me-1"],["class","text-muted",4,"ngIf"],["class","alert alert-warning mt-3",4,"ngIf"],[1,"table-responsive","mt-3"],["class","table table-bordered align-middle sombra-suave",4,"ngIf"],[1,"text-muted"],[1,"alert","alert-warning","mt-3"],[1,"table","table-bordered","align-middle","sombra-suave"],[1,"table-light"],[1,"sortable",3,"click"],["class","bi",3,"ngClass",4,"ngIf"],[1,"sortable","text-end",3,"click"],[4,"ngFor","ngForOf"],[1,"bi",3,"ngClass"],[2,"cursor","pointer",3,"click"],[1,"text-end"],[1,"form-select","input-estilizado",3,"ngModelChange","change","ngModel"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"h2",1),C(2,"i",2),d(3,"Pedidos realizados por clientes "),o(),i(4,"div",3)(5,"div",4)(6,"label",5),d(7,"Desde"),o(),i(8,"input",6),E("ngModelChange",function(l){return b(a.desde,l)||(a.desde=l),l}),o()(),i(9,"div",4)(10,"label",7),d(11,"Hasta"),o(),i(12,"input",8),E("ngModelChange",function(l){return b(a.hasta,l)||(a.hasta=l),l}),o()(),i(13,"div",4)(14,"label",9),d(15,"Estado"),o(),i(16,"select",10),E("ngModelChange",function(l){return b(a.estadoFiltro,l)||(a.estadoFiltro=l),l}),m("change",function(){return a.aplicarFiltroEstado()}),i(17,"option",11),d(18,"Todos"),o(),i(19,"option",12),d(20,"Pendiente"),o(),i(21,"option",13),d(22,"Enviado"),o(),i(23,"option",14),d(24,"Entregado"),o(),i(25,"option",15),d(26,"Cancelado"),o()()(),i(27,"div",16)(28,"button",17),m("click",function(){return a.cargarPedidos()}),C(29,"i",18),d(30," Filtrar "),o()()(),u(31,Q,2,0,"div",19)(32,X,2,0,"div",20),i(33,"div",21),u(34,ne,20,6,"table",22),o()()),e&2&&(s(8),x("ngModel",a.desde),s(4),x("ngModel",a.hasta),s(4),x("ngModel",a.estadoFiltro),s(15),c("ngIf",a.cargando),s(),c("ngIf",!a.pedidos.length&&!a.cargando),s(2),c("ngIf",a.pedidosFiltrados.length))},dependencies:[W,M,V,k,D,N,J,U,G,L,j,H,R],encapsulation:2})};export{q as PedidosClientesComponent};
