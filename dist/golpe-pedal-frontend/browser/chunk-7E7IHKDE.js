import{a as D}from"./chunk-4GUMZMTI.js";import{a as W}from"./chunk-GZI56UPR.js";import{a as A,c as k,f as j,t as V}from"./chunk-ND65VQ52.js";import{$ as U,B as p,C as I,Da as F,G as c,J as s,L as M,M as r,N as o,O as d,P as g,Q as _,R as S,S as C,T as m,W as l,X as b,Y as x,Z as y,a as E,aa as P,b as v,ba as R,pa as w,q as h,qa as L,r as O,ra as N,ua as T,z as i}from"./chunk-YAXSTRSO.js";function $(t,n){t&1&&(r(0,"div",9),d(1,"span",10),l(2," Cargando usuarios... "),o())}function z(t,n){if(t&1&&(r(0,"div",11),l(1),o()),t&2){let e=m();i(),b(e.error)}}function G(t,n){if(t&1&&(g(0),d(1,"i"),l(2),_()),t&2){let e=m(2).$implicit;i(),M(e.rol.nombre==="ROLE_CLIENTE"?"bi bi-person-up":"bi bi-person-down"),i(),x(" Cambiar a ",e.rol.nombre==="ROLE_CLIENTE"?"EMPLEADO":"CLIENTE"," ")}}function q(t,n){t&1&&(g(0),d(1,"span",23),l(2," Cambiando... "),_())}function H(t,n){if(t&1){let e=S();g(0),r(1,"button",22),C("click",function(){h(e);let f=m().$implicit,u=m(2);return O(u.cambiarRol(f))}),c(2,G,3,3,"ng-container",21)(3,q,3,0,"ng-container",21),o(),_()}if(t&2){let e=m().$implicit,a=m(2);i(),s("ngClass",e.rol.nombre==="ROLE_CLIENTE"?"btn-primario":"btn-secundario")("disabled",a.cambiandoRol[e.id]),i(),s("ngIf",!a.cambiandoRol[e.id]),i(),s("ngIf",a.cambiandoRol[e.id])}}function J(t,n){if(t&1&&(r(0,"tr")(1,"td",15),l(2),o(),r(3,"td",16),l(4),o(),r(5,"td",17),l(6),o(),r(7,"td",18)(8,"span",19),l(9),o()(),r(10,"td",20),c(11,H,4,4,"ng-container",21),o()()),t&2){let e=n.$implicit;i(2),b(e.id),i(2),y("",e.nombre," ",e.apellido1,""),i(2),b(e.email),i(2),s("ngClass",e.rol.nombre==="ROLE_CLIENTE"?"rol-cliente":"rol-interno"),i(),x(" ",e.rol.nombre," "),i(2),s("ngIf",e.rol.nombre!=="ROLE_ADMIN")}}function K(t,n){if(t&1&&(r(0,"table",12)(1,"thead",13)(2,"tr")(3,"th"),l(4,"ID"),o(),r(5,"th"),l(6,"Nombre"),o(),r(7,"th"),l(8,"Email"),o(),r(9,"th"),l(10,"Rol"),o(),r(11,"th"),l(12,"Acci\xF3n"),o()()(),r(13,"tbody"),c(14,J,12,7,"tr",14),o()()),t&2){let e=m();i(14),s("ngForOf",e.usuariosFiltrados)}}function Q(t,n){t&1&&(r(0,"div",24),d(1,"i",25),l(2," No se encontraron usuarios con ese email. "),o())}var B=class t{constructor(n,e,a){this.router=n;this.roleService=e;this.usuarioService=a}usuarios=[];error="";cargando=!1;cambiandoRol={};filtroEmail="";usuariosFiltrados=[];ngOnInit(){if(this.roleService.getRol()!=="ROLE_ADMIN"){this.router.navigate(["/dashboard"]);return}this.cargarUsuarios()}cargarUsuarios(){this.cargando=!0,this.usuarioService.obtenerUsuarios().subscribe({next:n=>{this.usuarios=n,this.filtrarUsuarios(),this.cargando=!1},error:n=>{console.error("\u274C Error al cargar usuarios:",n),this.error="No se pudo cargar la lista de usuarios.",this.cargando=!1}})}filtrarUsuarios(){let n=this.filtroEmail.trim().toLowerCase();this.usuariosFiltrados=this.usuarios.filter(e=>e.email.toLowerCase().includes(n))}cambiarRol(n){let e=n.rol.nombre==="ROLE_CLIENTE"?"ROLE_EMPLEADO":"ROLE_CLIENTE";this.usuarioService.cambiarRol(n.id,e).subscribe({next:()=>{n.rol=v(E({},n.rol),{nombre:e})},error:a=>{console.error("\u274C Error al cambiar rol:",a),this.error="No se pudo cambiar el rol del usuario."}})}static \u0275fac=function(e){return new(e||t)(p(F),p(D),p(W))};static \u0275cmp=I({type:t,selectors:[["app-usuarios"]],decls:10,vars:5,consts:[[1,"container","mt-4"],[1,"texto-grande","fw-bold","mb-4"],[1,"bi","bi-people","me-2"],["class","alert alert-info d-flex align-items-center gap-2",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"buscador-email"],["type","text","placeholder","Buscar por email...",1,"form-control","input-estilizado",3,"ngModelChange","input","ngModel"],["class","table table-bordered table-hover sombra-suave align-middle",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"alert","alert-info","d-flex","align-items-center","gap-2"],[1,"spinner-border","spinner-border-sm"],[1,"alert","alert-danger"],[1,"table","table-bordered","table-hover","sombra-suave","align-middle"],[1,"table-light"],[4,"ngFor","ngForOf"],["data-label","ID"],["data-label","Nombre"],["data-label","Email"],["data-label","Rol"],[3,"ngClass"],["data-label","Acci\xF3n"],[4,"ngIf"],[1,"btn","btn-sm","d-flex","align-items-center","gap-1",3,"click","ngClass","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"alert","alert-warning"],[1,"bi","bi-exclamation-triangle","me-2"]],template:function(e,a){e&1&&(r(0,"div",0)(1,"h2",1),d(2,"i",2),l(3,"Gesti\xF3n de Usuarios "),o(),c(4,$,3,0,"div",3)(5,z,2,1,"div",4),r(6,"div",5)(7,"input",6),R("ngModelChange",function(u){return P(a.filtroEmail,u)||(a.filtroEmail=u),u}),C("input",function(){return a.filtrarUsuarios()}),o()(),c(8,K,15,1,"table",7)(9,Q,3,0,"div",8),o()),e&2&&(i(4),s("ngIf",a.cargando),i(),s("ngIf",a.error),i(2),U("ngModel",a.filtroEmail),i(),s("ngIf",a.usuariosFiltrados.length),i(),s("ngIf",!a.usuariosFiltrados.length&&!a.cargando))},dependencies:[T,w,L,N,V,A,k,j],styles:[".rol-cliente[_ngcontent-%COMP%]{color:#ff6b00;font-weight:700}.rol-interno[_ngcontent-%COMP%]{color:#1e2a38;font-weight:700}.buscador-email[_ngcontent-%COMP%]{max-width:300px;margin-bottom:1.5rem}@media (max-width: 768px){.table[_ngcontent-%COMP%]{display:block;width:100%;overflow-x:auto}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem;padding:1rem;border:1px solid #E0E0E0;border-radius:.5rem;background-color:#fff;box-shadow:0 1px 4px #0000000d}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border:none!important}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);font-weight:700;color:#333;margin-right:.5rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{flex-direction:column;align-items:flex-start;gap:.5rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};export{B as UsuariosComponent};
