<div class="container mt-4">
  <h2 class="mb-4 texto-grande fw-bold">
    <i class="bi bi-bar-chart-line me-2"></i> Ventas por empleados
  </h2>

  <!-- Filtros -->
  <div class="row g-3 align-items-end sombra-suave p-3 borde-claro rounded-3">
    <div class="col-md-3">
      <label class="form-label">Desde</label>
      <input type="date" [(ngModel)]="desde" class="form-control input-estilizado" />
    </div>
    <div class="col-md-3">
      <label class="form-label">Hasta</label>
      <input type="date" [(ngModel)]="hasta" class="form-control input-estilizado" />
    </div>
    <div class="col-md-4">
      <label class="form-label">Empleado</label>
      <select [(ngModel)]="empleadoSeleccionado" class="form-select input-estilizado">
        <option value="">Todos</option>
        <option *ngFor="let emp of empleados" [value]="emp.id">{{ emp.email }}</option>
      </select>
    </div>
    <div class="col-12 col-md-2 text-md-end">
      <button class="btn btn-primario w-100 w-md-auto" (click)="cargarVentas()">
        <i class="bi bi-search me-1"></i> Filtrar
      </button>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="cargando" class="mt-4 text-muted">Cargando ventas...</div>

  <!-- Sin resultados -->
  <div *ngIf="!ventas.length && !cargando" class="alert alert-warning mt-4">
    No hay ventas para mostrar.
  </div>

  <!-- Tabla -->
  <div class="table-responsive mt-4">
    <table *ngIf="ventas.length" class="table table-bordered table-hover clickable-table">
      <thead class="table-light">
        <tr>
          <th class="sortable" (click)="ordenarPor('id')">Pedido <i *ngIf="sortField === 'id'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': sortDirection === 'asc', 'bi-caret-down-fill': sortDirection === 'desc' }"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('fecha')">Fecha <i *ngIf="sortField === 'fecha'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': sortDirection === 'asc', 'bi-caret-down-fill': sortDirection === 'desc' }"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('cliente')">Cliente <i *ngIf="sortField === 'cliente'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': sortDirection === 'asc', 'bi-caret-down-fill': sortDirection === 'desc' }"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('empleado')">Empleado <i *ngIf="sortField === 'empleado'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': sortDirection === 'asc', 'bi-caret-down-fill': sortDirection === 'desc' }"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('total')">Total <i *ngIf="sortField === 'total'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': sortDirection === 'asc', 'bi-caret-down-fill': sortDirection === 'desc' }"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let venta of ventasPaginadas; let i = index" (click)="irADetalle(venta.id)">
          <td data-label="Pedido">{{ (paginaActual - 1) * ventasPorPagina + i + 1 }} - {{ venta.numeroPedido }}</td>
          <td data-label="Fecha">{{ venta.fecha | date: 'short' }}</td>
          <td data-label="Cliente">{{ venta.cliente }}</td>
          <td data-label="Empleado">{{ venta.empleado }}</td>
          <td data-label="Total">{{ venta.total | currency: 'EUR':'symbol':'1.2-2':'es-ES' }}</td>
        </tr>
      </tbody>

    </table>
    <!-- PaginaciÃ³n -->
    <nav *ngIf="totalPaginas > 1" class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link" (click)="cambiarPagina(paginaActual - 1)">
            <i class="bi bi-chevron-left"></i>
          </button>
        </li>

        <li *ngFor="let pagina of [].constructor(totalPaginas); let i = index" class="page-item"
          [class.active]="paginaActual === i + 1">
          <button class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</button>
        </li>

        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link" (click)="cambiarPagina(paginaActual + 1)">
            <i class="bi bi-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>

  </div>