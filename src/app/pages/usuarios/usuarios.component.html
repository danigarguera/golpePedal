<div class="container mt-4">
  <h2 class="texto-grande fw-bold mb-4">
    <i class="bi bi-people me-2"></i>Gestión de Usuarios
  </h2>

  <div *ngIf="cargando" class="alert alert-info d-flex align-items-center gap-2">
    <span class="spinner-border spinner-border-sm"></span>
    Cargando usuarios...
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <table *ngIf="usuarios.length" class="table table-bordered table-hover sombra-suave">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Email</th>
        <th>Rol</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let usuario of usuarios">
        <td>{{ usuario.id }}</td>
        <td>{{ usuario.nombre }} {{ usuario.apellido1 }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.rol.nombre }}</td>
        <td>
          <button class="btn btn-sm btn-secundario"
            [disabled]="cambiandoRol[usuario.id] || usuario.rol.nombre === 'ROLE_ADMIN'" (click)="cambiarRol(usuario)">

            <ng-container *ngIf="!cambiandoRol[usuario.id]">
              <i class="bi bi-arrow-left-right me-1"></i>
              Cambiar a {{ usuario.rol.nombre === 'ROLE_CLIENTE' ? 'EMPLEADO' : 'CLIENTE' }}
            </ng-container>

            <ng-container *ngIf="cambiandoRol[usuario.id]">
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              Cambiando...
            </ng-container>
          </button>
        </td>

      </tr>
    </tbody>
  </table>
</div>