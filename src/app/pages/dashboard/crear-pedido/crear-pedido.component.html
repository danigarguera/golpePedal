<div class="container mt-4">
  <h2>üõí Crear Pedido</h2>

  <!-- Cliente y direcci√≥n -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label>Cliente</label>
      <select class="form-select" [(ngModel)]="clienteSeleccionadoId" (change)="onClienteChange()" name="cliente">
        <option *ngFor="let cliente of clientes" [value]="cliente.id">
          {{ cliente.nombre }} {{ cliente.apellido1 }}
        </option>
      </select>
    </div>
    <div class="col-md-6">
      <label>Direcci√≥n</label>
      <select class="form-select" [(ngModel)]="direccionSeleccionadaId" (change)="onDireccionChange()" name="direccion">
        <option *ngFor="let d of direcciones" [value]="d.id">{{ d.alias }} - {{ d.calle }}</option>
        <option [value]="-1">‚ûï A√±adir nueva direcci√≥n</option>
      </select>

      <!-- Formulario nueva direcci√≥n -->
      <div *ngIf="mostrarFormularioDireccion" class="border p-3 mt-2 bg-light rounded">
        <h5>‚ûï Nueva Direcci√≥n</h5>
        <div class="row">
          <div class="col-md-6">
            <input type="text" [(ngModel)]="nuevaDireccion.alias" class="form-control mb-2" placeholder="Alias">
            <input type="text" [(ngModel)]="nuevaDireccion.calle" class="form-control mb-2" placeholder="Calle">
            <input type="text" [(ngModel)]="nuevaDireccion.numero" class="form-control mb-2" placeholder="N√∫mero">
            <input type="text" [(ngModel)]="nuevaDireccion.piso" class="form-control mb-2" placeholder="Piso (opcional)">
          </div>
          <div class="col-md-6">
            <input type="text" [(ngModel)]="nuevaDireccion.codigoPostal" class="form-control mb-2" placeholder="C√≥digo Postal">
            <input type="text" [(ngModel)]="nuevaDireccion.ciudad" class="form-control mb-2" placeholder="Ciudad">
            <input type="text" [(ngModel)]="nuevaDireccion.provincia" class="form-control mb-2" placeholder="Provincia">
            <input type="text" [(ngModel)]="nuevaDireccion.pais" class="form-control mb-2" placeholder="Pa√≠s">
          </div>
        </div>
        <button class="btn btn-success mt-2" (click)="guardarNuevaDireccion()">Guardar direcci√≥n</button>
      </div>
    </div>
  </div>

  <!-- Filtro por tipo -->
  <div class="mb-3">
    <label>Tipo de componente</label>
    <select class="form-select" [(ngModel)]="tipoSeleccionado" (change)="filtrarComponentesPorTipo()" name="tipo">
      <option *ngFor="let tipo of tiposComponente" [value]="tipo.id">{{ tipo.nombre }}</option>
    </select>
  </div>

  <!-- Filtro por marca -->
  <div class="mb-3">
    <label>Marca</label>
    <select class="form-select" [(ngModel)]="marcaSeleccionada" (change)="filtrarComponentesPorTipo()" name="marca">
      <option [ngValue]="null">-- Todas las marcas --</option>
      <option *ngFor="let marca of marcas" [value]="marca.id">{{ marca.nombre }}</option>
    </select>
  </div>

  <!-- Componentes filtrados -->
  <h4>üì¶ Componentes disponibles</h4>
  <table class="table table-striped" *ngIf="componentesFiltrados.length > 0">
    <thead>
      <tr>
        <th (click)="ordenarPor('nombre')" style="cursor:pointer">Nombre</th>
        <th (click)="ordenarPor('marca')" style="cursor:pointer">Marca</th>
        <th (click)="ordenarPor('precio')" style="cursor:pointer">Precio</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let comp of componentesFiltrados">
        <td>{{ comp.nombre }}</td>
        <td>{{ comp.marca }}</td>
        <td>{{ comp.precio | currency:'EUR' }}</td>
        <td>
          <button class="btn btn-sm btn-success" (click)="anadirAlCarrito(comp)">‚ûï A√±adir</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Carrito -->
  <h4 class="mt-4">üßæ Componentes seleccionados</h4>
  <ul class="list-group mb-3">
    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of carrito">
      {{ item.nombre }} √ó {{ item.cantidad }} ‚Üí {{ item.precio * item.cantidad | currency:'EUR' }}
      <button class="btn btn-sm btn-danger" (click)="eliminarDelCarrito(item.componenteId)">‚ùå</button>
    </li>
  </ul>

  <p><strong>Total:</strong> {{ calcularTotal() | currency:'EUR' }}</p>
  <button class="btn btn-primary" (click)="crearPedido()">‚úÖ Finalizar Pedido</button>

  <div *ngIf="mensaje" class="alert alert-success mt-3">{{ mensaje }}</div>
  <div *ngIf="error" class="alert alert-danger mt-3">{{ error }}</div>
</div>
