<div class="container mt-4 max-ancho">
  <h2 class="texto-grande fw-bold mb-4">
    <i class="bi bi-bag-plus-fill me-2"></i> Crear Pedido
  </h2>

  <div class="card sombra-suave borde-claro p-3 mb-4">
    <h5 class="mb-3">Filtros de pedido</h5>

    <div class="row g-3">
      <!-- Cliente -->
      <div class="col-md-4">
        <label class="form-label">Cliente</label>
        <select class="form-select input-estilizado" [(ngModel)]="clienteSeleccionadoId" name="cliente">
          <option [ngValue]="null">-- Seleccionar cliente --</option>
          <option *ngFor="let cliente of clientes" [value]="cliente.id">
            {{ cliente.nombre }} {{ cliente.apellido1 }}
          </option>
        </select>
      </div>

      <!-- Tipo de componente -->
      <div class="col-md-4">
        <label class="form-label">Tipo de componente</label>
        <select class="form-select input-estilizado" [(ngModel)]="tipoSeleccionado"
          (change)="filtrarComponentesPorTipo()" name="tipo">
          <option [ngValue]="null">-- Todos los tipos --</option>
          <option *ngFor="let tipo of tiposComponente" [ngValue]="tipo.id">{{ tipo.nombre }}</option>
        </select>
      </div>

      <!-- Marca -->
      <div class="col-md-4">
        <label class="form-label">Marca</label>
        <select class="form-select input-estilizado" [(ngModel)]="marcaSeleccionada"
          (change)="filtrarComponentesPorTipo()" name="marca">
          <option [ngValue]="null">-- Todas las marcas --</option>
          <option *ngFor="let marca of marcas" [ngValue]="marca.id">{{ marca.nombre }}</option>
        </select>
      </div>
    </div>
  </div>


  <!-- Componentes disponibles -->
  <h4 class="mt-4 mb-3"><i class="bi bi-box-seam me-2"></i> Componentes disponibles</h4>

  <div class="table-responsive">
    <table class="table table-hover table-bordered align-middle sombra-suave">
      <thead class="table-light">
        <tr>
          <th class="sortable" (click)="ordenarPor('nombre')">
            Nombre
            <i *ngIf="campoOrden === 'nombre'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': direccionOrden === 'asc', 'bi-caret-down-fill': direccionOrden === 'desc' }"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('marca')">
            Marca
            <i *ngIf="campoOrden === 'marca'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': direccionOrden === 'asc', 'bi-caret-down-fill': direccionOrden === 'desc' }"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('precio')">
            Precio
            <i *ngIf="campoOrden === 'precio'" class="bi"
              [ngClass]="{ 'bi-caret-up-fill': direccionOrden === 'asc', 'bi-caret-down-fill': direccionOrden === 'desc' }"></i>
          </th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let comp of componentesPaginados">
          <td>{{ comp.nombre }}</td>
          <td>{{ comp.marca }}</td>
          <td>{{ comp.precio | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
          <td>
            <button class="btn btn-sm btn-primario" (click)="anadirAlCarrito(comp)">
              <i class="bi bi-cart-plus"></i> Añadir
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <nav *ngIf="totalPaginas > 1" class="d-flex justify-content-center mt-3">
    <ul class="pagination mb-0">
      <li class="page-item" [class.disabled]="paginaActual === 1">
        <button class="page-link" (click)="paginaActual = paginaActual - 1"
          [disabled]="paginaActual === 1">&laquo;</button>
      </li>

      <li class="page-item" *ngFor="let p of [].constructor(totalPaginas); let i = index"
        [class.active]="paginaActual === i + 1">
        <button class="page-link" (click)="paginaActual = i + 1">{{ i + 1 }}</button>
      </li>

      <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
        <button class="page-link" (click)="paginaActual = paginaActual + 1"
          [disabled]="paginaActual === totalPaginas">&raquo;</button>
      </li>
    </ul>
  </nav>



  <!-- Carrito -->
  <h4 class="mt-5 mb-3"><i class="bi bi-clipboard-check me-2"></i> Componentes seleccionados</h4>
  <ul class="list-group mb-3 sombra-suave">
    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of carrito">
      <span>
        {{ item.nombre }} × {{ item.cantidad }}
      </span>
      <span>
        {{ item.precio * item.cantidad |currency:'EUR':'symbol':'1.2-2':'es-ES' }}
        <button class="btn btn-sm btn-outline-danger ms-2" (click)="eliminarDelCarrito(item.componenteId)">
          <i class="bi bi-trash-fill"></i>
        </button>
      </span>
    </li>
  </ul>

  <!-- Total y Acción -->
  <div class="d-flex justify-content-between align-items-center mt-4">
    <h5>Total: {{ calcularTotal() |currency:'EUR':'symbol':'1.2-2':'es-ES' }}</h5>
    <button class="btn btn-secundario" (click)="crearPedido()">
      <i class="bi bi-check-circle me-1"></i> Finalizar Pedido
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="mensaje" class="alert alert-success mt-3">{{ mensaje }}</div>
  <div *ngIf="error" class="alert alert-danger mt-3">{{ error }}</div>
</div>