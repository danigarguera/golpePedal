<div class="container py-4">
  <h2 class="texto-grande fw-bold mb-4">
    <i class="bi bi-box-seam me-2"></i>Pedidos realizados por clientes
  </h2>

  <!-- Filtros -->
  <div class="row g-3 align-items-end mb-4 sombra-suave p-3 borde-claro rounded-3">
    <div class="col-md-3">
      <label for="desde" class="form-label">Desde</label>
      <input type="date" id="desde" [(ngModel)]="desde" class="form-control input-estilizado" />
    </div>
    <div class="col-md-3">
      <label for="hasta" class="form-label">Hasta</label>
      <input type="date" id="hasta" [(ngModel)]="hasta" class="form-control input-estilizado" />
    </div>
    <div class="col-md-3">
      <label for="estadoFiltro" class="form-label">Estado</label>
      <select id="estadoFiltro" [(ngModel)]="estadoFiltro" (change)="aplicarFiltroEstado()"
        class="form-select input-estilizado">
        <option value="">Todos</option>
        <option value="PENDIENTE">Pendiente</option>
        <option value="ENVIADO">Enviado</option>
        <option value="ENTREGADO">Entregado</option>
        <option value="CANCELADO">Cancelado</option>
      </select>
    </div>
    <div class="col-md-3 text-end">
      <button class="btn btn-primario w-100" (click)="cargarPedidos()">
        <i class="bi bi-filter me-1"></i> Filtrar
      </button>
    </div>
  </div>

  <!-- Mensajes de estado -->
  <div *ngIf="cargando" class="text-muted">Cargando pedidos...</div>
  <div *ngIf="!pedidos.length && !cargando" class="alert alert-warning mt-3">
    No hay pedidos para mostrar.
  </div>

  <div class="table-responsive mt-3">
    <table *ngIf="pedidosFiltrados.length" class="table table-bordered align-middle sombra-suave clickable-pedidos">
      <thead class="table-light">
        <tr>
          <th class="sortable" (click)="ordenarPor('id')">
            Pedido <i class="bi"
              [ngClass]="campoOrden === 'id' ? (direccionOrden === 'asc' ? 'bi-caret-up-fill' : 'bi-caret-down-fill') : ''"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('fecha')">
            Fecha <i class="bi"
              [ngClass]="campoOrden === 'fecha' ? (direccionOrden === 'asc' ? 'bi-caret-up-fill' : 'bi-caret-down-fill') : ''"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('cliente')">
            Cliente <i class="bi"
              [ngClass]="campoOrden === 'cliente' ? (direccionOrden === 'asc' ? 'bi-caret-up-fill' : 'bi-caret-down-fill') : ''"></i>
          </th>
          <th class="sortable text-end" (click)="ordenarPor('total')">
            Total <i class="bi"
              [ngClass]="campoOrden === 'total' ? (direccionOrden === 'asc' ? 'bi-caret-up-fill' : 'bi-caret-down-fill') : ''"></i>
          </th>
          <th class="sortable" (click)="ordenarPor('estado')">
            Estado <i class="bi"
              [ngClass]="campoOrden === 'estado' ? (direccionOrden === 'asc' ? 'bi-caret-up-fill' : 'bi-caret-down-fill') : ''"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pedido of pedidosPaginados">
          <td (click)="irADetalle(pedido.id)" style="cursor: pointer">{{ pedido.numeroPedido }}</td>
          <td (click)="irADetalle(pedido.id)">
            <span class="fecha-link">{{ pedido.fecha | date: 'short' }}</span>
          </td>
          <td>{{ pedido.cliente }}</td>
          <td class="text-end">{{ pedido.total | currency:'EUR':'symbol':'1.2-2':'es-ES' }}</td>
          <td>
            <div class="estado-wrapper">
              <select [(ngModel)]="pedido.estado" (change)="actualizarEstado(pedido)"
                class="form-select input-estilizado" [ngClass]="'estado-' + pedido.estado.toLowerCase()">
                <option value="PENDIENTE">Pendiente</option>
                <option value="ENVIADO">Enviado</option>
                <option value="ENTREGADO">Entregado</option>
                <option value="CANCELADO">Cancelado</option>
              </select>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PaginaciÃ³n -->
  <nav *ngIf="totalPaginas > 1" class="d-flex justify-content-center mt-4">
    <ul class="pagination mb-0">
      <li class="page-item" [class.disabled]="page === 1">
        <button class="page-link" (click)="page = page - 1" [disabled]="page === 1">&laquo;</button>
      </li>
      <li class="page-item" *ngFor="let p of [].constructor(totalPaginas); let i = index"
        [class.active]="page === i + 1">
        <button class="page-link" (click)="page = i + 1">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="page === totalPaginas">
        <button class="page-link" (click)="page = page + 1" [disabled]="page === totalPaginas">&raquo;</button>
      </li>
    </ul>
  </nav>
</div>