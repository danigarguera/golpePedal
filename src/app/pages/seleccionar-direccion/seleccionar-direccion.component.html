<div class="container py-4">
  <h2 class="texto-grande fw-bold mb-4">
    <i class="bi bi-geo-alt-fill me-2"></i> Selecciona una dirección para el envío
  </h2>

  <!-- Lista de direcciones -->
  <div *ngIf="direcciones.length > 0; else sinDirecciones">
    <div class="row row-cols-1 row-cols-md-2 g-4 mt-3">
      <div class="col" *ngFor="let direccion of direcciones">
        <div class="card sombra-suave borde-claro h-100">
          <div class="card-body">
            <h5 class="card-title fw-semibold">{{ direccion.alias }}</h5>
            <p class="card-text text-muted mb-3">
              {{ direccion.calle }}, {{ direccion.numero }}
              <span *ngIf="direccion.piso">, piso {{ direccion.piso }}</span><br>
              {{ direccion.codigoPostal }} {{ direccion.ciudad }} ({{ direccion.provincia }})<br>
              {{ direccion.pais }}
            </p>
            <button class="btn btn-primario w-100" (click)="seleccionarDireccion(direccion)">
              <i class="bi bi-check-circle-fill me-1"></i> Usar esta dirección
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje si no hay direcciones -->
  <ng-template #sinDirecciones>
    <div class="alert alert-info sombra-suave mt-4">
      No tienes direcciones guardadas. Añade una nueva abajo.
    </div>
  </ng-template>

  <!-- Formulario para nueva dirección -->
<div class="mt-5">
  <h4 class="mb-3"><i class="bi bi-plus-circle-fill me-2"></i>Añadir nueva dirección</h4>

  <form [formGroup]="formDireccion" (ngSubmit)="onSubmit()" class="sombra-suave p-4 rounded-3 bg-white borde-claro">
    <div class="row g-3">
      <div class="col-md-4"
        *ngFor="let campo of ['alias', 'calle', 'numero', 'piso', 'ciudad', 'provincia', 'codigoPostal', 'pais']">
        <label [for]="campo" class="form-label text-capitalize">{{ campo }}:</label>
        <input
          type="text"
          class="form-control input-estilizado"
          [formControlName]="campo"
          [id]="campo"
          [ngClass]="{ 'is-invalid': formDireccion.get(campo)?.invalid && formDireccion.get(campo)?.touched }"
          [attr.inputmode]="['numero', 'codigoPostal', 'piso'].includes(campo) ? 'numeric' : 'text'"
          [attr.pattern]="
            campo === 'numero' || campo === 'piso' ? '\\d+' :
            campo === 'codigoPostal' ? '\\d{5}' : null
          "
        />

        <!-- Validación -->
        <div *ngIf="formDireccion.get(campo)?.invalid && formDireccion.get(campo)?.touched" class="invalid-feedback">
          <div *ngIf="formDireccion.get(campo)?.errors?.['required']">Este campo es obligatorio.</div>
          <div *ngIf="formDireccion.get(campo)?.errors?.['minlength']">Debe tener al menos 3 caracteres.</div>
          <div *ngIf="formDireccion.get(campo)?.errors?.['pattern']">
            <ng-container [ngSwitch]="campo">
              <span *ngSwitchCase="'numero'">Solo se permiten números.</span>
              <span *ngSwitchCase="'codigoPostal'">Debe tener 5 dígitos.</span>
              <span *ngSwitchCase="'piso'">Solo se permiten números.</span>
              <span *ngSwitchDefault>Formato inválido.</span>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón guardar -->
    <div class="mt-4 text-end">
      <button type="submit" class="btn btn-secundario" [disabled]="formDireccion.invalid">
        <i class="bi bi-save me-1"></i> Guardar dirección
      </button>
    </div>
  </form>
</div>
